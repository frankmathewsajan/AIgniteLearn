{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIgnite - Ignite Your Future</title>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'learn/css/index.css' %}">
</head>
<body>
<!-- Navbar -->
<div class="navbar">
    <div class="nav-links">
        <a href="{% url 'index' %}" class="active">Home</a>
        <a href="{% url 'perks' %}">Leaderboard </a>
    </div>
    <div class="profile">

        <div class="streak">üî• Streak: {{ user.streak|default:0 }} days</div>
        <div role="button" style="cursor: pointer" class="perks" onclick="location.href='{% url 'perks' %}'">üí∞
            Perks: {{ user.perks|default:0 }}</div>
        <div class="rank">üèÜ Rank: {{ user.rank|default:0 }}</div>

        <!-- Display username instead of 'Profile' -->
        <div class="dropdown">
            <div style="display: flex;">
                <button class="dropdown-toggle" onclick="location.href='{% url 'profile' %}'">
                    <span style="font-size: larger;font-style: italic">{{ user.username }}</span> <i
                        class="fa-solid fa-user"></i>
                </button>
                <i style="margin-left: 10px;background-color: darkred"
                   class="fa-solid fa-right-from-bracket dropdown-toggle"
                   onclick="location.href='{% url 'logout' %}'"></i>
            </div>

        </div>
    </div>
</div>
{% block body %}{% endblock %}
<!-- Chat Box -->
<div class="chat-container">
    <div class="chat-toggle" onclick="toggleChat()">
        <i class="fa-solid fa-comments fa-lg"></i>
    </div>
    <div class="chat-window hidden">
        <div class="chat-header">
            <span>AIgnite Assistant</span>
            <button class="close-chat" onclick="toggleChat()">√ó</button>
        </div>
        <div class="chat-body">
    <div class="chat-messages" id="chat-messages">
        <!-- Django dynamically loaded messages -->
        {% for message in messages %}
            <div class="message {{ message.sender }}">{{ message.text }}</div>
        {% endfor %}
    </div>
    <div class="chat-footer">
        <script>
            function simulateAI() {
                const inputField = document.querySelector('input[name="message"]');
                const chatMessages = document.getElementById('chat-messages');
                const message = inputField.value.trim().toLowerCase();

                // Predefined responses
                const responses = {
                    "engineering": {
                        interests: [
                            "Biomedical Engineering",
                            "Robotics and Automation",
                            "Medical Imaging Technology",
                            "Nanotechnology in Medicine",
                            "Artificial Intelligence in Healthcare",
                            "Prosthetics and Wearable Devices",
                            "Healthcare Systems Optimization"
                        ],
                        goals: [
                            "Advance Medical Robotics and Devices",
                            "Develop Analytical and Problem-Solving Skills in Engineering",
                            "Enhance Research Methodologies in Biomedical Fields",
                            "Innovate AI Applications for Diagnostics and Treatment",
                            "Master the Design of Healthcare Systems",
                            "Pioneer Sustainable Engineering Solutions for Medical Needs",
                            "Contribute to Life-Saving Technologies"
                        ]
                    },
                    "medical": {
                        interests: [
                            "Surgical Innovations",
                            "Clinical Research",
                            "Pharmacology",
                            "Genomics",
                            "AI in Diagnostics",
                            "Telemedicine",
                            "Epidemiology"
                        ],
                        goals: [
                            "Develop AI Models for Predictive Healthcare",
                            "Improve Access to Telemedicine",
                            "Advance Genomic Medicine",
                            "Design Effective Medical Devices",
                            "Conduct Breakthrough Clinical Trials",
                            "Enhance Global Health Solutions",
                            "Master Advanced Diagnostic Tools"
                        ]
                    }
                };

                // Create the user's message bubble
                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'message user';
                userMessageDiv.textContent = inputField.value;
                chatMessages.appendChild(userMessageDiv);

                // AI "typing" indicator
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'message ai typing';
                typingIndicator.textContent = "AI is typing...";
                chatMessages.appendChild(typingIndicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Simulate AI response after delay
                setTimeout(() => {
                    // Remove typing indicator
                    typingIndicator.remove();

                    let responseMessage;
                    if (responses[message]) {
                        const response = responses[message];
                        responseMessage = `
                            <strong>Interests:</strong>
                            <ul>${response.interests.map(item => `<li>${item}</li>`).join('')}</ul>
                            <strong>Goals:</strong>
                            <ul>${response.goals.map(item => `<li>${item}</li>`).join('')}</ul>
                        `;
                    } else {
                        responseMessage = `
                            I'm not sure about "${message}". Here are some examples:
                            <ul>
                                <li>Try typing "engineering"</li>
                                <li>Or type "medical"</li>
                            </ul>
                        `;
                    }

                    // Create AI's response bubble
                    const aiMessageDiv = document.createElement('div');
                    aiMessageDiv.className = 'message ai';
                    aiMessageDiv.innerHTML = responseMessage;
                    chatMessages.appendChild(aiMessageDiv);

                    // Scroll to the bottom of the chat
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000); // Simulate delay

                // Clear the input field
                inputField.value = "";

                return false; // Prevent form submission
            }
        </script>

        <form method="POST" action="" onsubmit="return simulateAI()">
            {% csrf_token %}
            <input type="text" name="message" placeholder="Type your field (e.g., engineering, medical)..." required>
            <button type="submit" class="send-btn">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </form>
    </div>
</div>

<style>
    .chat-body {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        background-color: #f4f4f4;
    }
    .chat-footer {
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ddd;
    }
    .message {
        margin: 5px 0;
        padding: 10px;
        border-radius: 5px;
        max-width: 80%;
    }
    .message.user {
        background-color: #d1e7dd;
        align-self: flex-end;
    }
    .message.ai {
        background-color: #f8d7da;
        align-self: flex-start;
    }
    .message.typing {
        font-style: italic;
        background-color: #eee;
    }
    ul {
        margin: 0;
        padding-left: 20px;
    }
</style>

    </div>
</div>

<script>
    function toggleChat() {
        const chatWindow = document.querySelector('.chat-window');
        chatWindow.classList.toggle('hidden');
    }

</script>
</body>
</html>
